<!DOCTYPE html>
<html lang="zh">
    <head>
  <!-- 元数据 -->
  <meta charset="utf-8">
  <link rel="icon" href="https://cdn.jsdelivr.net/gh/teble/teble.github.io@blog-images/img/202112031459049.png">
  
  <title>SpringBoot接收LocalDateTime最佳实践 | teble&#39;s notes</title>
  <meta name="author" content="teble" />
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="robots" content="index,follow" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <meta name="format-detection" content="telphone=no, email=no" />
  
    <meta name="keywords" content="Java, SpringBoot, 后端" />
  
  <meta name="description" content="0x0. LocalDateTime在SpringBoot中的窘境问题由来：在前不久，我们后台就已经抛弃了Date这个类，而改用了java8提供的LocalDateTime，但是正常情况下LocalDateTime的构造函数是私有的，无法像Date那样直接被spring mvc直接处理，所以带给了我很多困扰，甚至有一次项目急迫致使我直接使用String去对时间进行接收，然后再通过DateTimeF">
<meta property="og:type" content="article">
<meta property="og:title" content="SpringBoot接收LocalDateTime最佳实践">
<meta property="og:url" content="https://blog.teble.me/2019/11/05/springboot-backend-receive-localdatetime/index.html">
<meta property="og:site_name" content="teble&#39;s notes">
<meta property="og:description" content="0x0. LocalDateTime在SpringBoot中的窘境问题由来：在前不久，我们后台就已经抛弃了Date这个类，而改用了java8提供的LocalDateTime，但是正常情况下LocalDateTime的构造函数是私有的，无法像Date那样直接被spring mvc直接处理，所以带给了我很多困扰，甚至有一次项目急迫致使我直接使用String去对时间进行接收，然后再通过DateTimeF">
<meta property="og:locale">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/teble/teble.github.io@blog-images/img/202112031459049.png">
<meta property="article:published_time" content="2019-11-05T01:12:30.000Z">
<meta property="article:modified_time" content="2023-03-01T11:07:18.109Z">
<meta property="article:author" content="teble">
<meta property="article:tag" content="SpringBoot">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="后端">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/teble/teble.github.io@blog-images/img/202112031459049.png">
  
  <!-- 站点验证相关 -->
  
    
    
    
  
  <!-- 样式表文件 -->
  <link rel="stylesheet" id="kratos-css" href="/css/kratosr.min.css" media="all"></script>
  
    <link rel="stylesheet" id="darkmode-css" href="/css/kr-color-dark.min.css" media="(prefers-color-scheme: dark)"></script>
    <script src="/js/kr-dark.min.js"></script>
  
  
    <link rel="stylesheet" id="highlight-css" href="/css/highlight/night-eighties.min.css" media="all"></script>
  
  <link rel="stylesheet" id="fontawe-css" href="/vendors/font-awesome@4.7.0/css/font-awesome.min.css" media="all"></script>
  <link rel="stylesheet" id="nprogress-css" href="/vendors/nprogress@0.2.0/nprogress.css" media="all"></script>
  
  
    <link rel="stylesheet" href="/vendors/aplayer@1.10.1/dist/APlayer.min.css"></script>
  
  
    <link rel="stylesheet" href="/vendors/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"></script>
  
  <!-- 不得不预先加载的一些JS文件 -->
  <script src="/vendors/jquery@3.6.0/dist/jquery.min.js"></script>
  
    <script src="/vendors/qrcode_js@1.0.0/qrcode.min.js"></script>
  
  
  <style>
    
    
  </style>
  
<meta name="generator" content="Hexo 6.2.0"></head>


    <body class="custom-background">
        <div id="kratos-wrapper">
    <div id="kratos-page">
        <div id="kratos-header">
            <header id="kratos-desktop-topnav" class="kratos-topnav">
                <div class="container">
                    <div class="nav-header">
                        <nav id="kratos-menu-wrap">
                            <ul id="kratos-primary-menu" class="sf-menu">
                                
                                    
                                    
                                        
                                            <li><a href="/"><i class="fa fa-home"></i>首页</a></li>
                                        
                                    
                                        
                                            <li><a href="/archives/"><i class="fa fa-file"></i>档案馆</a></li>
                                        
                                    
                                        
                                            <li><a href="/friends/"><i class="fa fa-paw"></i>好伙伴</a></li>
                                        
                                    
                                
                            </ul>
                        </nav>
                    </div>
                </div>
            </header>
            <header id="kratos-mobile-topnav" class="kratos-topnav">
                <div class="container">
                    <div class="color-logo"><a href="/">teble&#39;s notes</a></div>
                    <div class="nav-toggle">
                        <a class="kratos-nav-toggle js-kratos-nav-toggle">
                            <i></i>
                        </a>
                    </div>
                </div>
            </header>
        </div>
        <div class="kratos-start kratos-hero-2">
            <!-- <div class="kratos-overlay"></div> -->
            <div class="kratos-cover kratos-cover-2 text-center">
                <div class="desc desc2 animate-box">
                    <a href="/">
                        <h2>teble&#39;s notes</h2> <br />
                        <span>只会摸鱼</span>
                    </a>
                </div>
            </div>
        </div>

        <div id="kratos-blog-post">
            <div class="container">
                <div id="main" class="row">
                    

        

            <section class="col-md-8">

        

            <article itemscope itemtype="https://schema.org/Article">
    
    <link itemprop="mainEntityOfPage" href="https://blog.teble.me/2019/11/05/springboot-backend-receive-localdatetime/">
    <div class="kratos-hentry kratos-post-inner clearfix">
        <header class="kratos-entry-header">
            
                <h1 class="kratos-entry-title text-center" itemprop="name headline">SpringBoot接收LocalDateTime最佳实践</h1>
            
            
            <ul class="kratos-post-meta text-center">
                <li><time datetime="2019-11-05T01:12:30.000Z" itemprop="datePublished"><i class="fa fa-calendar"></i> 2019-11-05</time></li>
                <li itemprop="author" itemscope itemtype="https://schema.org/Person">
                    <i class="fa fa-user"></i> 作者 <span itemprop="name">teble</span>
                </li>
                
                    <li>
                        <i class="fa fa-edit"></i> 
                        
                        
                            ~19.87K
                        
                        字
                    </li>
                
                
            </ul>
        </header>
        <div class="kratos-post-content">
            
            <div id="expire-alert" class="alert alert-warning hidden" role="alert">
                <div class="icon"><i class="fa fa-warning"></i></div>
                <div class="text"><p>本文最后编辑于 <time datetime="1677668838109"></time> 前，其中的内容可能需要更新。</p></div>
            </div>
            
            
            
                <div class="kratos-post-inner-toc toc-div-class" >
                    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x0-LocalDateTime%E5%9C%A8SpringBoot%E4%B8%AD%E7%9A%84%E7%AA%98%E5%A2%83"><span class="toc-number">1.</span> <span class="toc-text">0x0. LocalDateTime在SpringBoot中的窘境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x1-%E5%88%9D%E6%AD%A5%E8%A7%A3%E5%86%B3LocalDateTime%E4%BD%9C%E4%B8%BAquery%E5%8F%82%E6%95%B0%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">2.</span> <span class="toc-text">0x1. 初步解决LocalDateTime作为query参数的问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x2-%E5%AF%BB%E6%89%BE%E5%85%A8%E5%B1%80%E8%A7%A3%E5%86%B3%E6%96%B9%E5%BC%8F"><span class="toc-number">3.</span> <span class="toc-text">0x2. 寻找全局解决方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x3-%E6%B7%B1%E5%85%A5%E7%A0%94%E7%A9%B6%E5%88%86%E6%9E%90%E5%8F%82%E6%95%B0%E8%BD%AC%E6%8D%A2%E8%BF%87%E7%A8%8B"><span class="toc-number">4.</span> <span class="toc-text">0x3. 深入研究分析参数转换过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x4-%E5%88%9B%E5%BB%BA%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90%E5%99%A8"><span class="toc-number">5.</span> <span class="toc-text">0x4. 创建参数解析器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x5-%E6%8E%A8%E8%8D%90%E4%BD%BF%E7%94%A8%E6%B3%A8%E5%86%8CConvert%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-number">6.</span> <span class="toc-text">0x5. 推荐使用注册Convert的方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x6-%E5%B0%8F%E7%BB%93"><span class="toc-number">7.</span> <span class="toc-text">0x6. 小结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0xf-%E9%99%84%E5%BD%95"><span class="toc-number">8.</span> <span class="toc-text">0xf. 附录</span></a></li></ol>
                </div>
            
            <hr />
            <div itemprop="articleBody"><link rel="stylesheet" type="text&#x2F;css" href="https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css"><h2 id="0x0-LocalDateTime在SpringBoot中的窘境"><a href="#0x0-LocalDateTime在SpringBoot中的窘境" class="headerlink" title="0x0. LocalDateTime在SpringBoot中的窘境"></a>0x0. LocalDateTime在SpringBoot中的窘境</h2><p><strong>问题由来</strong>：在前不久，我们后台就已经抛弃了Date这个类，而改用了java8提供的LocalDateTime，但是正常情况下LocalDateTime的构造函数是私有的，无法像Date那样直接被spring mvc直接处理，所以带给了我很多困扰，甚至有一次项目急迫致使我直接使用String去对时间进行接收，然后再通过DateTimeFormatter在Controller层对参数进行了一层处理，才能将LocalDateTime传给了Service进行处理，直接导致的结果就是方法变得有点丑陋了（逃~</p>
<span id="more"></span>

<h2 id="0x1-初步解决LocalDateTime作为query参数的问题"><a href="#0x1-初步解决LocalDateTime作为query参数的问题" class="headerlink" title="0x1. 初步解决LocalDateTime作为query参数的问题"></a>0x1. 初步解决LocalDateTime作为query参数的问题</h2><p>经过多方面查询得知，对于java8时间格式的问题，其实困扰着很多人，网上也提供了很多的解决方案，比如说下面这种在query参数上加注解的方式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestApi</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/time&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> RestInfo <span class="title function_">getTime</span><span class="params">(<span class="meta">@RequestParam</span></span></span><br><span class="line"><span class="params">                            <span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span></span><br><span class="line"><span class="params">                                LocalDateTime time)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> RestInfo.ok(time);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>请求结果如下：<br><img src="https://ae01.alicdn.com/kf/H41b34ac5e5b948be9c5c318d008dec74R.png" alt="请求结果"></p>
<p>但是这样造成的后果是严重影响了代码的质量，每个使用LocalDateTime的参数的地方都需要使用两个注解。</p>
<h2 id="0x2-寻找全局解决方式"><a href="#0x2-寻找全局解决方式" class="headerlink" title="0x2. 寻找全局解决方式"></a>0x2. 寻找全局解决方式</h2><p>接着我又继续尝试了这一种在加了@Configuration的类中使用@Bean注入了一个Convert转换器的方式就是一种很常见的方法（PS：LocalDateTimeUtils是我自己写的一个工具类，后面再提）:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Converter&lt;String, LocalDateTime&gt; <span class="title function_">localDateTimeConvert</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Converter</span>&lt;String, LocalDateTime&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> LocalDateTime <span class="title function_">convert</span><span class="params">(String source)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (StringUtils.isEmpty(source)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> LocalDateTimeUtils.convert(source.trim());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Controller层代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestApi</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/time&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> RestInfo <span class="title function_">getTime</span><span class="params">(LocalDateTime time)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> RestInfo.ok(time);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是我使用过后却并没有得到我想要的效果，出现了报错，这是为什么？<br>得到的报错如下<code>java.lang.IllegalStateException: No primary or default constructor found for class java.time.LocalDateTime</code>，仔细想了一下为什么别人能使用呢，后面才发现自己缺少了一个注解@RequestParam，好的，我这就去加上：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestApi</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/time&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> RestInfo <span class="title function_">getTime</span><span class="params">(<span class="meta">@RequestParam</span> LocalDateTime time)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> RestInfo.ok(time);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>请求结果：<br><img src="https://ae01.alicdn.com/kf/H58bf0648f70749978e2bfa1ccf130e2e8.png" alt="请求结果"></p>
<p>nice！全局方式query也生效了，现在我们来尝试一下使用Model去接收参数：</p>
<p>TestModel:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestModel</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime time;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Controller层：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestApi</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/model&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> RestInfo <span class="title function_">getModel</span><span class="params">(TestModel model)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> RestInfo.ok(model);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>请求结果：<br><img src="https://ae01.alicdn.com/kf/Hfbf7b43a25aa445ab1fccf243d49241bh.png"></p>
<p>嗯，现在已经大致满足要求了，但是对于简洁到了极致的自己来说却依旧不能感到满足，为什么LocalDateTime作为一个属性存在于Model中时却不需要使用注解方式去指定呢？而我们不使用@RequestParam时LocalDateTime却会出现报错？</p>
<h2 id="0x3-深入研究分析参数转换过程"><a href="#0x3-深入研究分析参数转换过程" class="headerlink" title="0x3. 深入研究分析参数转换过程"></a>0x3. 深入研究分析参数转换过程</h2><p>我们先在先在Controller层下一个断点，然后查看调用堆栈，找到了一个可疑的方法：invokeForRequest<br><img src="https://ae01.alicdn.com/kf/Hbed78744be2e49c191d8d2d243d55791s.png"></p>
<p>我们点进去看一看：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">invokeForRequest</span><span class="params">(NativeWebRequest request, <span class="meta">@Nullable</span> ModelAndViewContainer mavContainer,</span></span><br><span class="line"><span class="params">        Object... providedArgs)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// 这个方法应该是获取参数的，跟进方法看一下做了什么</span></span><br><span class="line">    Object[] args = getMethodArgumentValues(request, mavContainer, providedArgs);</span><br><span class="line">    <span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">        logger.trace(<span class="string">&quot;Arguments: &quot;</span> + Arrays.toString(args));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> doInvoke(args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Object[] getMethodArgumentValues(NativeWebRequest request, <span class="meta">@Nullable</span> ModelAndViewContainer mavContainer,</span><br><span class="line">        Object... providedArgs) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// 获取方法参数列表</span></span><br><span class="line">    MethodParameter[] parameters = getMethodParameters();</span><br><span class="line">    <span class="keyword">if</span> (ObjectUtils.isEmpty(parameters)) &#123;</span><br><span class="line">        <span class="keyword">return</span> EMPTY_ARGS;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Object[] args = <span class="keyword">new</span> <span class="title class_">Object</span>[parameters.length];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; parameters.length; i++) &#123;</span><br><span class="line">        <span class="type">MethodParameter</span> <span class="variable">parameter</span> <span class="operator">=</span> parameters[i];</span><br><span class="line">        parameter.initParameterNameDiscovery(<span class="built_in">this</span>.parameterNameDiscoverer);</span><br><span class="line">        args[i] = findProvidedArgument(parameter, providedArgs);</span><br><span class="line">        <span class="keyword">if</span> (args[i] != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.resolvers.supportsParameter(parameter)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(formatArgumentError(parameter, <span class="string">&quot;No suitable resolver&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 这里应该进行的是参数绑定操作，跟进</span></span><br><span class="line">            args[i] = <span class="built_in">this</span>.resolvers.resolveArgument(parameter, mavContainer, request, <span class="built_in">this</span>.dataBinderFactory);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            <span class="comment">// Leave stack trace for later, exception may actually be resolved and handled...</span></span><br><span class="line">            <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">exMsg</span> <span class="operator">=</span> ex.getMessage();</span><br><span class="line">                <span class="keyword">if</span> (exMsg != <span class="literal">null</span> &amp;&amp; !exMsg.contains(parameter.getExecutable().toGenericString())) &#123;</span><br><span class="line">                    logger.debug(formatArgumentError(parameter, exMsg));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">throw</span> ex;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> args;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">resolveArgument</span><span class="params">(MethodParameter parameter, <span class="meta">@Nullable</span> ModelAndViewContainer mavContainer,</span></span><br><span class="line"><span class="params">        NativeWebRequest webRequest, <span class="meta">@Nullable</span> WebDataBinderFactory binderFactory)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// 继续跟进，方法就紧跟在下边</span></span><br><span class="line">    <span class="type">HandlerMethodArgumentResolver</span> <span class="variable">resolver</span> <span class="operator">=</span> getArgumentResolver(parameter);</span><br><span class="line">    <span class="keyword">if</span> (resolver == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Unsupported parameter type [&quot;</span> +</span><br><span class="line">                parameter.getParameterType().getName() + <span class="string">&quot;]. supportsParameter should be called first.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> resolver.resolveArgument(parameter, mavContainer, webRequest, binderFactory);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">private</span> HandlerMethodArgumentResolver <span class="title function_">getArgumentResolver</span><span class="params">(MethodParameter parameter)</span> &#123;</span><br><span class="line">    <span class="comment">// 在springboot 2.2.0 时这里会直接将LocalDateTime的解析器确定为RequestParamMethodArgumentResolver</span></span><br><span class="line">    <span class="type">HandlerMethodArgumentResolver</span> <span class="variable">result</span> <span class="operator">=</span> <span class="built_in">this</span>.argumentResolverCache.get(parameter);</span><br><span class="line">    <span class="keyword">if</span> (result == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 这里argumentResolvers是注册的参数解析器列表</span></span><br><span class="line">        <span class="keyword">for</span> (HandlerMethodArgumentResolver resolver : <span class="built_in">this</span>.argumentResolvers) &#123;</span><br><span class="line">            <span class="keyword">if</span> (resolver.supportsParameter(parameter)) &#123;</span><br><span class="line">                result = resolver;</span><br><span class="line">                <span class="built_in">this</span>.argumentResolverCache.put(parameter, result);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们展开参数解析器的列表：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">this.argumentResolvers = &#123;LinkedList@6957&#125;  size = 26</span><br><span class="line"> 0 = &#123;RequestParamMethodArgumentResolver@6959&#125; </span><br><span class="line"> 1 = &#123;RequestParamMapMethodArgumentResolver@7055&#125; </span><br><span class="line"> 2 = &#123;PathVariableMethodArgumentResolver@7056&#125; </span><br><span class="line"> 3 = &#123;PathVariableMapMethodArgumentResolver@7057&#125; </span><br><span class="line"> 4 = &#123;MatrixVariableMethodArgumentResolver@7058&#125; </span><br><span class="line"> 5 = &#123;MatrixVariableMapMethodArgumentResolver@7059&#125; </span><br><span class="line"> 6 = &#123;ServletModelAttributeMethodProcessor@7060&#125; </span><br><span class="line"> 7 = &#123;RequestResponseBodyMethodProcessor@7061&#125; </span><br><span class="line"> 8 = &#123;RequestPartMethodArgumentResolver@7062&#125; </span><br><span class="line"> 9 = &#123;RequestHeaderMethodArgumentResolver@7063&#125; </span><br><span class="line"> 10 = &#123;RequestHeaderMapMethodArgumentResolver@7064&#125; </span><br><span class="line"> 11 = &#123;ServletCookieValueMethodArgumentResolver@7065&#125; </span><br><span class="line"> 12 = &#123;ExpressionValueMethodArgumentResolver@7066&#125; </span><br><span class="line"> 13 = &#123;SessionAttributeMethodArgumentResolver@7067&#125; </span><br><span class="line"> 14 = &#123;RequestAttributeMethodArgumentResolver@7068&#125; </span><br><span class="line"> 15 = &#123;ServletRequestMethodArgumentResolver@7069&#125; </span><br><span class="line"> 16 = &#123;ServletResponseMethodArgumentResolver@7070&#125; </span><br><span class="line"> 17 = &#123;HttpEntityMethodProcessor@7071&#125; </span><br><span class="line"> 18 = &#123;RedirectAttributesMethodArgumentResolver@7072&#125; </span><br><span class="line"> 19 = &#123;ModelMethodProcessor@7073&#125; </span><br><span class="line"> 20 = &#123;MapMethodProcessor@7074&#125; </span><br><span class="line"> 21 = &#123;ErrorsMethodArgumentResolver@7075&#125; </span><br><span class="line"> 22 = &#123;SessionStatusMethodArgumentResolver@7076&#125; </span><br><span class="line"> 23 = &#123;UriComponentsBuilderMethodArgumentResolver@7077&#125; </span><br><span class="line"> 24 = &#123;RequestParamMethodArgumentResolver@7078&#125; </span><br><span class="line"> 25 = &#123;ServletModelAttributeMethodProcessor@7079&#125; </span><br></pre></td></tr></table></figure>

<p>是不是看到了几个看着很眼熟的东西？<code>RequestParam</code>,<code>PathVariable</code>,<code>RequestBody</code>，在idea中查找RequestParamMethodArgumentResolver类，进入他的方法看一下，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supportsParameter</span><span class="params">(MethodParameter parameter)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (parameter.hasParameterAnnotation(RequestParam.class)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (Map.class.isAssignableFrom(parameter.nestedIfOptional().getNestedParameterType())) &#123;</span><br><span class="line">            <span class="comment">// RequestParam眼熟不，getParameterAnnotation，对应的就是@RequestParam注解</span></span><br><span class="line">            <span class="type">RequestParam</span> <span class="variable">requestParam</span> <span class="operator">=</span> parameter.getParameterAnnotation(RequestParam.class);</span><br><span class="line">            <span class="keyword">return</span> (requestParam != <span class="literal">null</span> &amp;&amp; StringUtils.hasText(requestParam.name()));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (parameter.hasParameterAnnotation(RequestPart.class)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        parameter = parameter.nestedIfOptional();</span><br><span class="line">        <span class="keyword">if</span> (MultipartResolutionDelegate.isMultipartArgument(parameter)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.useDefaultResolution) &#123;</span><br><span class="line">            <span class="keyword">return</span> BeanUtils.isSimpleProperty(parameter.getNestedParameterType());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里可以基本确定一件事，在我这测试时默认的参数解析器有26个，每个参数解析器有着各自的用途，比如加了@RequestParam注解的参数会被RequestParamMethodArgumentResolver所解析，然后再查找类型有无相应的Convert转换器，在我们这里使用@Bean注入了一个Convert转换器，所以LocalDateTime能被正确的解析。</p>
<p>那么我们之前不加@RequestParam直接使用LocalDateTime作为参数的时候是被哪个解析器所捕获的呢，方法已经找到了，那么直接下个断点跑一遍查看result返回的是哪个解析器就知道了！<br><img src="https://ae01.alicdn.com/kf/H9dadf5167f2c4916b892b073f713c112B.png"></p>
<p>如果没记错ServletModelAttributeMethodProcessor是参数解析器的最后一个，我们进入到这个类看一眼，没有supportsParameter方法，但是他继承了ModelAttributeMethodProcessor，我们再进入他的父类中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supportsParameter</span><span class="params">(MethodParameter parameter)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (parameter.hasParameterAnnotation(ModelAttribute.class) ||</span><br><span class="line">            (<span class="built_in">this</span>.annotationNotRequired &amp;&amp; !BeanUtils.isSimpleProperty(parameter.getParameterType())));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对于没有指定参数解析器的参数来说，默认指定的参数解析器是ModelAttributeMethodProcessor，并且由源码得知，如果加了@ModelAttribute注解，或者非简单属性则会被该解析器捕获，所以我们平时所使用的model去接收不需要加注解即可被正确的解析，既然都来了，那么顺便看一下resolveArgument方法是怎么解析参数的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> Object <span class="title function_">resolveArgument</span><span class="params">(MethodParameter parameter, <span class="meta">@Nullable</span> ModelAndViewContainer mavContainer,</span></span><br><span class="line"><span class="params">        NativeWebRequest webRequest, <span class="meta">@Nullable</span> WebDataBinderFactory binderFactory)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="keyword">if</span> (mavContainer.containsAttribute(name)) &#123;</span><br><span class="line">        attribute = mavContainer.getModel().get(name);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Create attribute instance</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 这里是对参数的绑定构建了，点进去看一眼</span></span><br><span class="line">            attribute = createAttribute(name, parameter, binderFactory, webRequest);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (BindException ex) &#123;</span><br><span class="line">            <span class="keyword">if</span> (isBindExceptionRequired(parameter)) &#123;</span><br><span class="line">                <span class="comment">// No BindingResult parameter -&gt; fail with BindException</span></span><br><span class="line">                <span class="keyword">throw</span> ex;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// Otherwise, expose null/empty value and associated BindingResult</span></span><br><span class="line">            <span class="keyword">if</span> (parameter.getParameterType() == Optional.class) &#123;</span><br><span class="line">                attribute = Optional.empty();</span><br><span class="line">            &#125;</span><br><span class="line">            bindingResult = ex.getBindingResult();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>继续跟进createAttribute方法，看看他是怎么将值绑定给对象的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Object <span class="title function_">createAttribute</span><span class="params">(String attributeName, MethodParameter parameter,</span></span><br><span class="line"><span class="params">        WebDataBinderFactory binderFactory, NativeWebRequest webRequest)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">MethodParameter</span> <span class="variable">nestedParameter</span> <span class="operator">=</span> parameter.nestedIfOptional();</span><br><span class="line">    Class&lt;?&gt; clazz = nestedParameter.getNestedParameterType();</span><br><span class="line"></span><br><span class="line">    Constructor&lt;?&gt; ctor = BeanUtils.findPrimaryConstructor(clazz);</span><br><span class="line">    <span class="keyword">if</span> (ctor == <span class="literal">null</span>) &#123;</span><br><span class="line">        Constructor&lt;?&gt;[] ctors = clazz.getConstructors();</span><br><span class="line">        <span class="keyword">if</span> (ctors.length == <span class="number">1</span>) &#123;</span><br><span class="line">            ctor = ctors[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                ctor = clazz.getDeclaredConstructor();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (NoSuchMethodException ex) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;No primary or default constructor found for &quot;</span> + clazz, ex);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">Object</span> <span class="variable">attribute</span> <span class="operator">=</span> constructAttribute(ctor, attributeName, parameter, binderFactory, webRequest);</span><br><span class="line">    <span class="keyword">if</span> (parameter != nestedParameter) &#123;</span><br><span class="line">        attribute = Optional.of(attribute);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> attribute;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看到这里是不是发现报错的地方有点熟悉？这就是我们之前LocalDateTime抛出异常的地方了，可以得知对于对象的绑定，先通过BeanUtils获取主要的构造函数，如果获取不到，则使用反射的方式先尝试获取声明为public的无参构造函数，最后才会尝试使用getDeclaredConstructor获取所有的无参构造函数，但是对于LocalDateTime这种使用工厂构造不存在无参构造函数的类来说就会直接抛出NoSuchMethodException异常。那么如果我们不想使用@RequestParam注解加在参数上怎么办呢？</p>
<h2 id="0x4-创建参数解析器"><a href="#0x4-创建参数解析器" class="headerlink" title="0x4. 创建参数解析器"></a>0x4. 创建参数解析器</h2><p>如果我们不希望在LocalDateTime上增加注解，然后再通过RequestParamMethodArgumentResolver解析，我们可以自己定制一种针对LocalDateTime的参数解析器，通过继承WebMvcConfigurer重写addArgumentResolvers方法，然后add一个自定义的HandlerMethodArgumentResolver即可解决刚才的问题，但是在2.2.0版本上会自动指定LocalDateTime的解析器原因未知（我太蔡了…找不到是怎么做到的，想看看他是怎么获取的，但是发现那个方法再无限调用，完全没有头绪。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 增加 &#123;<span class="doctag">@link</span> LocalDateTime&#125; 的自定义参数解析器，不需要用注解方式指定query参数即可解析</span></span><br><span class="line"><span class="comment">     * 2.2.0版本后较大改变，自动确定LocalDateTime解析器为 &#123;<span class="doctag">@link</span></span></span><br><span class="line"><span class="comment">     * org.springframework.web.method.annotation.RequestParamMethodArgumentResolver&#125;</span></span><br><span class="line"><span class="comment">     * 但是依旧可以注册使用本解析器</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addArgumentResolvers</span><span class="params">(List&lt;HandlerMethodArgumentResolver&gt; resolvers)</span> &#123;</span><br><span class="line">        resolvers.add(<span class="keyword">new</span> <span class="title class_">LocalDateArgumentResolverHandler</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">LocalDateArgumentResolverHandler</span> <span class="keyword">implements</span> <span class="title class_">HandlerMethodArgumentResolver</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supportsParameter</span><span class="params">(MethodParameter parameter)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> parameter.getParameterType().equals(LocalDateTime.class);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Object <span class="title function_">resolveArgument</span><span class="params">(MethodParameter parameter, ModelAndViewContainer mavContainer,</span></span><br><span class="line"><span class="params">                                      NativeWebRequest webRequest, WebDataBinderFactory binderFactory)</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">param</span> <span class="operator">=</span> webRequest.getParameter(Objects.requireNonNull(parameter.getParameterName()));</span><br><span class="line">            <span class="keyword">if</span> (StringUtils.isEmpty(param)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> LocalDateTimeUtils.convert(param.trim());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="0x5-推荐使用注册Convert的方式"><a href="#0x5-推荐使用注册Convert的方式" class="headerlink" title="0x5. 推荐使用注册Convert的方式"></a>0x5. 推荐使用注册Convert的方式</h2><p>相比于注入@Bean的方式创建Convert的方式，我个人更喜欢使用继承WebMvcConfigurer后重写addFormatters方法来注册自定义Convert。这种方式相比于@Bean注入，更容易让人理解，代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addFormatters</span><span class="params">(FormatterRegistry registry)</span> &#123;</span><br><span class="line">        registry.addConverter(<span class="keyword">new</span> <span class="title class_">LocalDateTimeConverter</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">LocalDateTimeConverter</span> <span class="keyword">implements</span> <span class="title class_">Converter</span>&lt;String, LocalDateTime&gt; &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> LocalDateTime <span class="title function_">convert</span><span class="params">(String source)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (StringUtils.isEmpty(source)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> LocalDateTimeUtils.convert(source.trim());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="0x6-小结"><a href="#0x6-小结" class="headerlink" title="0x6. 小结"></a>0x6. 小结</h2><p>对于request参数其实还有initBinder，Formatter等方式进行处理，这里就不一一贴出来了，有兴趣的各位可以在网上查询相关资料。还有jackson相关的序列化，通过继承com.fasterxml.jackson.databind.JsonDeserializer和com.fasterxml.jackson.databind.JsonSerializer生成自定义的Jackson Deserializer和Serializer，然后在@Configuration注解的配置类内注入@Bean将Jackson Module注册为@Bean，SpringBoot会自动注入进ObjectMapper中。另一种方式是自己注入一个自己定制的ObjectMapper为@Bean，然后将Module注入进ObjectMapper中。甚至可以通过定制转换规则，从而使类型支持多种参数。</p>
<h2 id="0xf-附录"><a href="#0xf-附录" class="headerlink" title="0xf. 附录"></a>0xf. 附录</h2><p>时间字符串转 LocalDateTime 工具类。转换不同时区的时间为本地时间（默认使用 <code>ZoneId.systemDefault()</code> 为本地时区）</p>
<ul>
<li>支持10位秒时间戳</li>
<li>13位毫秒时间戳</li>
<li>通用时间格式: <code>yyyy-MM-dd HH:mm[:ss][.sss]</code></li>
<li>ISO-8601 时间格式: <code>yyyy-MM-ddTHH:mm[:ss][.sss][Z|(+|-)HH:mm]</code></li>
<li>RFC-3339 时间格式: <code>yyyy-MM-dd HH:mm[:ss][.sss][Z|(+|-)HH:mm]</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 时间字符串转 LocalDateTime 工具类</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> teble</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">LocalDateTimeUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">Pattern</span> <span class="variable">DATE_TIME_PATTERN</span> <span class="operator">=</span> Pattern.compile(<span class="string">&quot;^\\d&#123;4&#125;-\\d&#123;2&#125;-\\d&#123;2&#125;[T ]\\d&#123;2&#125;:\\d&#123;2&#125;.*$&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">ZoneId</span> <span class="variable">LOCAL_ZONE_ID</span> <span class="operator">=</span> ZoneId.systemDefault();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">DateTimeFormatter</span> <span class="variable">LOCAL_DATE_TIME_FORMATTER</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DateTimeFormatterBuilder</span>()</span><br><span class="line">            .parseCaseInsensitive()</span><br><span class="line">            .append(ISO_LOCAL_DATE)</span><br><span class="line">            .optionalStart()</span><br><span class="line">            .appendLiteral(<span class="string">&#x27;T&#x27;</span>)</span><br><span class="line">            .optionalEnd()</span><br><span class="line">            .optionalStart()</span><br><span class="line">            .appendLiteral(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">            .optionalEnd()</span><br><span class="line">            .append(ISO_LOCAL_TIME)</span><br><span class="line">            .toFormatter();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isTimestamp</span><span class="params">(<span class="meta">@NonNull</span> String resolver)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; resolver.length(); i++) &#123;</span><br><span class="line">            <span class="type">char</span> <span class="variable">ch</span> <span class="operator">=</span> resolver.charAt(i);</span><br><span class="line">            <span class="keyword">if</span> (!Character.isDigit(ch)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> resolver.length() == <span class="number">10</span> || resolver.length() == <span class="number">13</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isOffsetDateTime</span><span class="params">(<span class="meta">@NonNull</span> String resolver)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">10</span>; i &lt; resolver.length(); i++) &#123;</span><br><span class="line">            <span class="type">char</span> <span class="variable">ch</span> <span class="operator">=</span> resolver.charAt(i);</span><br><span class="line">            <span class="keyword">if</span> (ch == <span class="string">&#x27;Z&#x27;</span> || ch == <span class="string">&#x27;+&#x27;</span> || ch == <span class="string">&#x27;-&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isZonedDateTime</span><span class="params">(<span class="meta">@NonNull</span> String resolver)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> resolver.endsWith(<span class="string">&quot;]&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">getISOTimeStr</span><span class="params">(<span class="meta">@NonNull</span> String resolver)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (resolver.charAt(<span class="number">10</span>) == <span class="string">&#x27; &#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> resolver.substring(<span class="number">0</span>, <span class="number">10</span>) + <span class="string">&quot;T&quot;</span> + resolver.substring(<span class="number">11</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> resolver;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LocalDateTime <span class="title function_">convert</span><span class="params">(<span class="meta">@Nullable</span> String resolver)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (resolver == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (isTimestamp(resolver)) &#123;</span><br><span class="line">            Instant instant;</span><br><span class="line">            <span class="keyword">if</span> (resolver.length() == <span class="number">10</span>) &#123;</span><br><span class="line">                instant = Instant.ofEpochSecond(Long.parseLong(resolver));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                instant = Instant.ofEpochMilli(Long.parseLong(resolver));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> LocalDateTime.ofInstant(instant, LOCAL_ZONE_ID);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (DATE_TIME_PATTERN.matcher(resolver).matches()) &#123;</span><br><span class="line">            <span class="comment">// compatibility RFC 3339</span></span><br><span class="line">            resolver = getISOTimeStr(resolver);</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">isZoned</span> <span class="operator">=</span> isZonedDateTime(resolver);</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">isOffset</span> <span class="operator">=</span> isOffsetDateTime(resolver);</span><br><span class="line">            <span class="keyword">if</span> (isOffset &amp;&amp; isZoned) &#123;</span><br><span class="line">                <span class="keyword">return</span> ZonedDateTime.parse(resolver, DateTimeFormatter.ISO_ZONED_DATE_TIME)</span><br><span class="line">                        .withZoneSameInstant(LOCAL_ZONE_ID)</span><br><span class="line">                        .toLocalDateTime();</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isOffset) &#123;</span><br><span class="line">                <span class="keyword">return</span> ZonedDateTime.parse(resolver, DateTimeFormatter.ISO_OFFSET_DATE_TIME)</span><br><span class="line">                        .withZoneSameInstant(LOCAL_ZONE_ID)</span><br><span class="line">                        .toLocalDateTime();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> LocalDateTime.parse(resolver, LOCAL_DATE_TIME_FORMATTER);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// ISO 8601</span></span><br><span class="line">        System.out.println(convert(<span class="string">&quot;2011-12-03T10:15:30+01:00[Europe/Paris]&quot;</span>));</span><br><span class="line">        System.out.println(convert(<span class="string">&quot;2011-12-03T10:15:30+01:00&quot;</span>));</span><br><span class="line">        System.out.println(convert(<span class="string">&quot;2011-12-03T10:15:30Z&quot;</span>));</span><br><span class="line">        <span class="comment">// RFC 3339</span></span><br><span class="line">        System.out.println(convert(<span class="string">&quot;2011-12-03 10:15:30.123Z&quot;</span>));</span><br><span class="line">        System.out.println(convert(<span class="string">&quot;2011-12-03 10:15:30.123+01:00&quot;</span>));</span><br><span class="line">        <span class="comment">// LOCAL TIME</span></span><br><span class="line">        System.out.println(convert(<span class="string">&quot;2011-12-03 10:15:30&quot;</span>));</span><br><span class="line">        <span class="comment">// TIMESTAMP</span></span><br><span class="line">        System.out.println(convert(<span class="string">&quot;1322819330&quot;</span>));</span><br><span class="line">        System.out.println(convert(<span class="string">&quot;1322819330123&quot;</span>));</span><br><span class="line">        <span class="comment">// INVALID</span></span><br><span class="line">        System.out.println(convert(<span class="string">&quot;123&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
        </div>
        
            <div class="kratos-copyright text-center clearfix">
                <h5 itemprop="copyrightNotice">本作品采用 <a rel="license nofollow" target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/">知识共享署名-相同方式共享 4.0 国际许可协议</a> 进行许可</h5>
            </div>
        
        <footer class="kratos-entry-footer clearfix">
            
                <div class="post-like-donate text-center clearfix" id="post-like-donate">
                
                
                    <a class="share" href="javascript:;"><i class="fa fa-share-alt"></i> 分享</a>
                    <div class="share-wrap" style="display: none;">
    <div class="share-group">
        <a href="javascript:;" class="share-plain qq" onclick="share('qq');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-qq"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain qzone" onclick="share('qzone');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-star"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain weixin pop style-plain" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-weixin"></i>
            </div>
            <div class="share-int">
                <div class="qrcode" id="wechat-qr"></div>
                <p>打开微信“扫一扫”，打开网页后点击屏幕右上角分享按钮</p>
            </div>
        </a>
        <a href="javascript:;" class="share-plain weibo" onclick="share('weibo');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-weibo"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain facebook style-plain" onclick="share('facebook');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-facebook"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain twitter style-plain" onclick="share('twitter');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-twitter"></i>
            </div>
        </a>
    </div>
    <script type="text/javascript">
        $(()=>{
            new QRCode("wechat-qr", {
                text: "https://blog.teble.me/2019/11/05/springboot-backend-receive-localdatetime/",
                width: 150,
                height: 150,
                correctLevel : QRCode.CorrectLevel.H
            });
        });
        function share(dest) {
            const qqBase        = "https://connect.qq.com/widget/shareqq/index.html?";
            const weiboBase     = "https://service.weibo.com/share/share.php?";
            const qzoneBase     = "https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?";
            const facebookBase  = "https://www.facebook.com/sharer/sharer.php?";
            const twitterBase   = "https://twitter.com/intent/tweet?";
            const hostUrl       = "https://blog.teble.me/2019/11/05/springboot-backend-receive-localdatetime/";
            const title         = "「SpringBoot接收LocalDateTime最佳实践」";
            const excerpt       = `0x0. LocalDateTime在SpringBoot中的窘境问题由来：在前不久，我们后台就已经抛弃了Date这个类，而改用了java8提供的LocalDateTime，但是正常情况下LocalDateTime的构造函数是私有的，无法像Date那样直接被spring mvc直接处理，所以带给了我很多困扰，甚至有一次项目急迫致使我直接使用String去对时间进行接收，然后再通过DateTimeFormatter在Controller层对参数进行了一层处理，才能将LocalDateTime传给了Service进行处理，直接导致的结果就是方法变得有点丑陋了（逃~`;
            let _URL;
            switch (dest) {
                case "qq"       : _URL = qqBase+"url="+hostUrl+"&title="+title+"&desc=&summary="+excerpt+"&site=cxpy";     break;
                case "weibo"    : _URL = weiboBase+"url="+hostUrl+"&title="+title+excerpt;                                 break;
                case "qzone"    : _URL = qzoneBase+"url="+hostUrl+"&title="+title+"&desc=&summary="+excerpt+"&site=cxpy";  break;
                case "facebook" : _URL = facebookBase+"u="+hostUrl;                                                        break;
                case "twitter"  : _URL = twitterBase+"text="+title+excerpt+"&url="+hostUrl;                                break;
            }
            window.open(_URL);
        };
    </script>
</div>
                
                </div>
            
            <div class="footer-tag clearfix">
                <div class="pull-left">
                <i class="fa fa-tags"></i>
                    <a class="tag-none-link" href="/tags/Java/" rel="tag">Java</a>, <a class="tag-none-link" href="/tags/SpringBoot/" rel="tag">SpringBoot</a>, <a class="tag-none-link" href="/tags/%E5%90%8E%E7%AB%AF/" rel="tag">后端</a>
                </div>
                <div class="pull-date">
                    <time datetime="2023-03-01T11:07:18.109Z" itemprop="dateModified">最后编辑：2023-03-01</time>
                </div>
            </div>
        </footer>
    </div>
    
        <nav class="navigation post-navigation clearfix" role="navigation">
            
            <div class="nav-previous clearfix">
                <a title=" 博客终于搭好了" href="/2019/10/31/blog-create/">&lt; 上一篇</a>
            </div>
            
            
            <div class="nav-next clearfix">
                <a title=" 记录一次startUML破解" href="/2019/12/02/startuml3.1.1-crack/">下一篇 &gt;</a>
            </div>
            
        </nav>
    
    
        <link rel="stylesheet" href="/vendors/gitalk@1.7.2/dist/gitalk.css"></script>
<div id="gitalk-container" class="post-comments lazy-load" style="padding-left:2rem; padding-right:2rem;"></div>
<script src="/js/md5.min.js"></script>
<script>
    var load_comm = () => {
        const init = () => {
            console.log('Gitalk loading...');
            const gitalk = new Gitalk(Object.assign({
                id: md5('/2019/11/05/springboot-backend-receive-localdatetime/'),
                path: '/2019/11/05/springboot-backend-receive-localdatetime/'
            }, JSON.parse('{"clientID":"c98a9571b6708589e1f7","clientSecret":"66e214dd4d229c9ed71b2b469423c683f7099410","repo":"teble.github.io","owner":"teble","admin":["teble"],"distractionFreeMode":false}')));

            gitalk.render('gitalk-container');
        }
        if (typeof Gitalk === 'undefined') {
            const src = '/vendors/gitalk@1.7.2/dist/gitalk.min.js';
            $.getScript(src, init);
        } else {
            init();
        }
    };
</script>
<noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="https://github.com/gitalk/gitalk">comments powered by Gitalk.</a></noscript>
    
</article>

        

            </section>

        

                
            

<section id="kratos-widget-area" class="col-md-4 hidden-xs hidden-sm">
    <!-- 文章和页面根据splitter来分割，没有的话就从头开始设置为sticky -->
    
    
                <aside id="krw-about" class="widget widget-kratos-about clearfix">
    <div class="photo-background"></div>
    <div class="photo-wrapper clearfix">
        <div class="photo-wrapper-tip text-center">
            <img class="about-photo" src="https://cdn.jsdelivr.net/gh/teble/teble.github.io@blog-images/img/20211202173817.png" loading="lazy" decoding="auto" />
        </div>
    </div>
    <div class="textwidget">
        <p class="text-center">一个成天摸鱼只会咕咕咕的混子</p>
    </div>
    <div class="site-meta">
        <a class="meta-item" href="/archives/">
            <span class="title">
                文章
            </span>
            <span class="count">
                5
            </span>
        </a>
        <a class="meta-item" href="/categories/">
            <span class="title">
                分类
            </span>
            <span class="count">
                2
            </span>
        </a>
        <a class="meta-item" href="/tags/">
            <span class="title">
                标签
            </span>
            <span class="count">
                11
            </span>
        </a>
    </div>
</aside>
            
                    <div class="sticky-area">
                
                    <aside id="krw-toc" class="widget widget-kratos-toc clearfix toc-div-class" >
    <div class="photo-background"></div>
    <h4 class="widget-title no-after">
        <i class="fa fa-compass"></i>
        文章目录
        <span class="toc-progress-bar" role="progressbar" aria-label="阅读进度："></span>
    </h4>
    <div class="textwidget">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x0-LocalDateTime%E5%9C%A8SpringBoot%E4%B8%AD%E7%9A%84%E7%AA%98%E5%A2%83"><span class="toc-text">0x0. LocalDateTime在SpringBoot中的窘境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x1-%E5%88%9D%E6%AD%A5%E8%A7%A3%E5%86%B3LocalDateTime%E4%BD%9C%E4%B8%BAquery%E5%8F%82%E6%95%B0%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-text">0x1. 初步解决LocalDateTime作为query参数的问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x2-%E5%AF%BB%E6%89%BE%E5%85%A8%E5%B1%80%E8%A7%A3%E5%86%B3%E6%96%B9%E5%BC%8F"><span class="toc-text">0x2. 寻找全局解决方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x3-%E6%B7%B1%E5%85%A5%E7%A0%94%E7%A9%B6%E5%88%86%E6%9E%90%E5%8F%82%E6%95%B0%E8%BD%AC%E6%8D%A2%E8%BF%87%E7%A8%8B"><span class="toc-text">0x3. 深入研究分析参数转换过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x4-%E5%88%9B%E5%BB%BA%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90%E5%99%A8"><span class="toc-text">0x4. 创建参数解析器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x5-%E6%8E%A8%E8%8D%90%E4%BD%BF%E7%94%A8%E6%B3%A8%E5%86%8CConvert%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-text">0x5. 推荐使用注册Convert的方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x6-%E5%B0%8F%E7%BB%93"><span class="toc-text">0x6. 小结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0xf-%E9%99%84%E5%BD%95"><span class="toc-text">0xf. 附录</span></a></li></ol>
    </div>
</aside>
                
                
  <aside id="krw-categories" class="widget widget-kratos-categories clearfix">
    <h4 class="widget-title"><i class="fa fa-folder"></i>分类目录</h4>
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%91%B8%E9%B1%BC%E6%97%A5%E5%B8%B8/">摸鱼日常</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a><span class="category-list-count">3</span></li></ul>
  </aside>


            
                
  <aside id="krw-tags" class="widget widget-kratos-tags clearfix">
    <h4 class="widget-title"><i class="fa fa-tags"></i>标签聚合</h4>
      <div class="tag-clouds">
        <a href="/tags/Java/" style="font-size: 0.6em;">Java</a> <a href="/tags/SpringBoot/" style="font-size: 0.6em;">SpringBoot</a> <a href="/tags/StartUML/" style="font-size: 0.6em;">StartUML</a> <a href="/tags/c/" style="font-size: 0.6em;">c++</a> <a href="/tags/spock/" style="font-size: 0.6em;">spock</a> <a href="/tags/springboot/" style="font-size: 0.6em;">springboot</a> <a href="/tags/zlib/" style="font-size: 0.6em;">zlib</a> <a href="/tags/%E5%90%8E%E7%AB%AF/" style="font-size: 0.6em;">后端</a> <a href="/tags/%E6%B5%8B%E8%AF%95/" style="font-size: 0.6em;">测试</a> <a href="/tags/%E7%9E%8E%E8%AF%B4/" style="font-size: 0.6em;">瞎说</a> <a href="/tags/%E7%A0%B4%E8%A7%A3/" style="font-size: 0.6em;">破解</a>
      </div>
  </aside>

            
                
  <aside id="krw-posts" class="widget widget-kratos-posts">
  <h4 class="widget-title"><i class="fa fa-file"></i>最新文章</h4>
  <div class="tab-content">
      <ul class="list-group">
        
        
          
          
            <a class="list-group-item" href="/2022/12/15/zlib-stream-uncompress/"><i class="fa  fa-book"></i> 基于Zlib的c++流式解压</a>
            
          
        
          
          
            <a class="list-group-item" href="/2021/12/29/spock-spring2-study-note1/"><i class="fa  fa-book"></i> spock初探</a>
            
          
        
          
          
            <a class="list-group-item" href="/2019/12/02/startuml3.1.1-crack/"><i class="fa  fa-book"></i> 记录一次startUML破解</a>
            
          
        
          
          
            <a class="list-group-item" href="/2019/11/05/springboot-backend-receive-localdatetime/"><i class="fa  fa-book"></i> SpringBoot接收LocalDateTime最佳实践</a>
            
          
        
          
          
            <a class="list-group-item" href="/2019/10/31/blog-create/"><i class="fa  fa-book"></i> 博客终于搭好了</a>
            
          
        
      </ul>
  </div>
  </aside>

            
    </div>
</section>
        
        </div>
    </div>
</div>
<footer>
    <div id="footer"  class="ap-lrc"  >
        <div class="container">
            <div class="row">
                <div class="col-md-6 col-md-offset-3 footer-list text-center">
                    <ul class="kratos-social-icons">
                        <!-- Keep for compatibility -->
                        
                        
                        
                        
                        
                        
                        
                        <li><a target="_blank" rel="nofollow" href="https://github.com/teble"><i class="fa fa-github"></i></a></li>
                        
                        <!-- New links -->
                        
                    </ul>
                    <ul class="kratos-copyright">
                        <div>
                            <li>&copy; 2023 teble's notes 版权所有.</li>
                            <li>本站已运行<span id="span_dt">Loading...</span></li>
                        </div>
                        <div>
                            <li>Theme <a href="https://github.com/Candinya/Kratos-Rebirth" target="_blank">Kratos:Rebirth</a></li>
                            <li>Site built with&nbsp;<i class="fa fa-heart throb" style="color:#d43f57"></i>&nbsp;by teble.</li>
                        </div>
                        <div>
                            <li>Powered by <a href="https://hexo.io" target="_blank" rel="nofollow">Hexo</a></li>
                            <li>Hosted on <a href="https://github.io" target="_blank">Github Pages</a></li>
                        </div>
                        <div>
                            
                            
                        </div>
                    </ul>
                </div>
            </div>
        </div>
        <div class="kr-tool text-center">
            <div class="tool">
                
                    <div class="box search-box">
                        <a href="/search/">
                            <span class="fa fa-search"></span>
                        </a>
                    </div>
                
                
                    <div class="box theme-box" id="darkmode-switch">
                        <span class="fa fa-adjust"></span>
                    </div>
                
                
                
            </div>
            <div class="box gotop-box">
                <span class="fa fa-chevron-up"></span>
            </div>
        </div>
    </div>
</footer>
</div>
</div>

        <script defer src="/vendors/bootstrap@3.3.4/dist/js/bootstrap.min.js"></script>
<script defer src="/vendors/nprogress@0.2.0/nprogress.js"></script>
<script>
    if (!window.kr) {
        window.kr = {};
    }
    window.kr.notMobile = (!(navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)));
    window.kr.siteRoot = "/";
</script>


    <script async src="/js/candy.min.js"></script>



    <script defer src="/vendors/aplayer@1.10.1/dist/APlayer.min.js"></script>
    
    <script defer src="/vendors/meting@2.0.1/dist/Meting.min.js"></script>
    <meting-js
        server="netease"
        type="playlist"
        id="2580669122"
        order="random"
        fixed="true"
    >
    </meting-js>



    <script defer src="/vendors/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>

<script defer src="/js/kratosr.min.js"></script>
<script defer src="/js/pjax.min.js"></script>



<!-- Extra support for third-party plguins  -->


    </body>
</html>